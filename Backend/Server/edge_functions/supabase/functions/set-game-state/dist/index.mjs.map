{"version":3,"sources":["../index.ts","../../../../../../lib/games/set_game_state.js"],"sourcesContent":["import { serve } from \"https://deno.land/std/http/server.ts\";\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2\";\nimport { setGameState } from \"../../../../../lib/games/set_game_state.js\";\n\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Headers\":\n    \"authorization, x-client-info, apikey, content-type\",\n};\n\nserve(async (req) => {\n  if (req.method === \"OPTIONS\")\n    return new Response(\"ok\", { headers: corsHeaders });\n\n  const { gameId, new_state } = await req.json();\n  if (!gameId || !new_state) {\n    return new Response(\"Missing gameId or new_state\", {\n      status: 400,\n      headers: corsHeaders,\n    });\n  }\n\n  const supabase = createClient(\n    Deno.env.get(\"SUPABASE_URL\")!,\n    Deno.env.get(\"SUPABASE_ANON_KEY\")!,\n    { global: { headers: { Authorization: req.headers.get(\"Authorization\") } } }\n  );\n\n  try {\n    await setGameState(supabase, gameId, new_state);\n    return new Response(\"State updated\", { headers: corsHeaders });\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: corsHeaders,\n    });\n  }\n});\n","export const setGameState = async (supabase, gameId, new_state) => {\r\n  const { error } = await supabase\r\n    .from(\"games\")\r\n    .update({ state: new_state })\r\n    .eq(\"id\", gameId);\r\n  if (error) throw error;\r\n};"],"mappings":";AAAA,SAAS,aAAa;AACtB,SAAS,oBAAoB;;;ACDtB,IAAM,eAAe,OAAO,UAAU,QAAQ,cAAc;AACjE,QAAM,EAAE,MAAM,IAAI,MAAM,SACrB,KAAK,OAAO,EACZ,OAAO,EAAE,OAAO,UAAU,CAAC,EAC3B,GAAG,MAAM,MAAM;AAClB,MAAI,MAAO,OAAM;AACnB;;;ADFA,IAAM,cAAc;AAAA,EAClB,+BAA+B;AAAA,EAC/B,gCACE;AACJ;AAEA,MAAM,OAAO,QAAQ;AACnB,MAAI,IAAI,WAAW;AACjB,WAAO,IAAI,SAAS,MAAM,EAAE,SAAS,YAAY,CAAC;AAEpD,QAAM,EAAE,QAAQ,UAAU,IAAI,MAAM,IAAI,KAAK;AAC7C,MAAI,CAAC,UAAU,CAAC,WAAW;AACzB,WAAO,IAAI,SAAS,+BAA+B;AAAA,MACjD,QAAQ;AAAA,MACR,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AAEA,QAAM,WAAW;AAAA,IACf,KAAK,IAAI,IAAI,cAAc;AAAA,IAC3B,KAAK,IAAI,IAAI,mBAAmB;AAAA,IAChC,EAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,IAAI,QAAQ,IAAI,eAAe,EAAE,EAAE,EAAE;AAAA,EAC7E;AAEA,MAAI;AACF,UAAM,aAAa,UAAU,QAAQ,SAAS;AAC9C,WAAO,IAAI,SAAS,iBAAiB,EAAE,SAAS,YAAY,CAAC;AAAA,EAC/D,SAAS,OAAO;AACd,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,MAAM,QAAQ,CAAC,GAAG;AAAA,MAC5D,QAAQ;AAAA,MACR,SAAS;AAAA,IACX,CAAC;AAAA,EACH;AACF,CAAC;","names":[]}